---
description: Sistema de Inventario - Items, containers, currencies y propiedades con Effects
globs: packages/core/core/domain/inventory/**
alwaysApply: false
---

# Sistema de Inventario

> **Documentacion completa**: Consulta la skill `entities` (`.claude/skills/entities/docs/05-inventory.md`) para arquitectura, instance fields dinamicos, compilacion de effects, y ejemplos detallados.

Sistema de inventario basado en entidades que coexiste con el sistema legacy `equipment`.

## API Rapida

### Items

```typescript
import { inventoryOps } from '@zukus/core';

// AÃ±adir item
inventoryOps.addItem(state, { itemId, entityType, entity });

// Eliminar
inventoryOps.removeItem(state, instanceId, quantity?);

// Actualizar
inventoryOps.updateItem(state, instanceId, updates);

// Toggle equipado
inventoryOps.toggleItemEquipped(state, instanceId);

// Apilar con existente
inventoryOps.addOrStackItem(state, itemId, entityType, quantity);
```

### Instance Fields

```typescript
import {
  isItemEquipped, setItemEquipped,
  isItemWielded, setItemWielded,
  isItemActive, setItemActive,
  getInstanceFieldsFromCompendium,
  hasInstanceField,
} from '@zukus/core';

// Helpers tipados
if (isItemEquipped(item)) { ... }
const updated = setItemEquipped(item, true);

// Descubrir campos dinamicamente
const fields = getInstanceFieldsFromCompendium('armor', compendium);
```

### Containers

```typescript
inventoryOps.moveToContainer(state, instanceId, containerId);
inventoryOps.removeFromContainer(state, instanceId);
inventoryOps.getContainerContents(state, containerId);
```

### Currencies

```typescript
inventoryOps.addCurrency(currencies, 'gold', 100);
inventoryOps.removeCurrency(currencies, 'gold', 50);
inventoryOps.convertCurrency(currencies, 'gold', 'silver', 10, currencyDefs);
```

### CharacterUpdater

```typescript
updater.addToInventory({ itemId, entityType, entity });
updater.removeFromInventory(instanceId, quantity?);
updater.updateInventoryItem(instanceId, updates);
updater.toggleInventoryEquipped(instanceId);
updater.setInventoryInstanceField(instanceId, fieldName, value);
updater.addCurrency(currencyId, amount);
updater.spendCurrency(currencyId, amount);
```

## Addons Clave

| Addon | Tipo | Campos |
|-------|------|--------|
| `dnd35item` | fields | weight, cost, itemSlot, aura, casterLevel |
| `container` | fields | capacity, ignoresContentWeight |
| `equippable` | instanceField | equipped: boolean |
| `wieldable` | instanceField | wielded: boolean |
| `activable` | instanceField | active: boolean |
| `stackable` | instanceField | quantity: number |

## Archivos

| Archivo | Proposito |
|---------|-----------|
| `inventory/types.ts` | Tipos base |
| `inventory/itemOperations.ts` | CRUD de items |
| `inventory/instanceFields.ts` | Helpers equipped/wielded/active |
| `entities/instanceFields/getInstanceFields.ts` | Descubrimiento dinamico |
| `character/calculation/effects/compileEffects.ts` | Compilacion de effects |
