---
description: Reglas para el desarrollo del Sistema de Niveles v2
globs: packages/core/**
alwaysApply: false
---
# Desarrollo del Sistema de Niveles v2

## UbicaciÃ³n del Sistema

Todo el cÃ³digo de este sistema estÃ¡ en `core/domain/levels/`.

## DocumentaciÃ³n de Referencia

| Archivo | PropÃ³sito |
|---------|-----------|
| `core/domain/levels/IMPLEMENTATION_PLAN.md` | Plan maestro con estado de fases |
| `core/domain/levels/START_HERE.md` | Punto de entrada para cada fase |
| `core/domain/levels/docs/CONTEXT.md` | Contexto global y metodologÃ­a |
| `core/domain/levels/docs/phases/phase-X-clarifications.md` | Aclaraciones por fase |
| `core/domain/levels/docs/phases/phase-X-full-context.md` | Contexto consolidado por fase |

---

## ğŸ›‘ REGLAS CRÃTICAS

### 1. Test First (OBLIGATORIO)
- **SIEMPRE escribir tests ANTES de implementar**
- Los tests definen el comportamiento esperado
- No se considera completo un entregable sin sus tests pasando

### 2. Baby Steps (OBLIGATORIO)
- Cada cambio debe ser pequeÃ±o y verificable
- No hacer cambios grandes de una vez
- Cada paso debe ser completamente funcional antes de pasar al siguiente

### 3. Control del Humano (OBLIGATORIO)
- **El humano supervisor debe confirmar CADA decisiÃ³n de dominio**
- Este es un dominio crÃ­tico; el humano tiene la Ãºltima palabra
- Presentar opciones y esperar confirmaciÃ³n antes de implementar
- **NO asumir; PREGUNTAR**

### 4. Una Fase a la Vez
- Solo trabaja en la fase marcada como "ğŸ”„ EN PROGRESO"
- NO avances a la siguiente fase sin confirmaciÃ³n explÃ­cita del humano
- NO leas documentaciÃ³n de fases futuras innecesariamente

---

## Flujo de Trabajo por Fase

### Al Iniciar una Fase

1. **Leer el archivo de contexto de la fase**:
   - `docs/phases/phase-X-full-context.md` (recomendado, todo en uno)
   - O: `docs/phases/phase-X-clarifications.md` + cÃ³digo existente

2. **Actualizar estado** en `IMPLEMENTATION_PLAN.md`:
   ```markdown
   ### Estado: ğŸ”„ EN PROGRESO
   ```

3. **Presentar preguntas pendientes** al humano y **ESPERAR CONFIRMACIÃ“N**

4. **Documentar decisiones** en el ApÃ©ndice de `IMPLEMENTATION_PLAN.md`

### Al Implementar

5. **Escribir tests primero** basados en casos de uso
6. **Implementar** hasta que los tests pasen
7. **Verificar** criterios de aceptaciÃ³n

### Al Completar una Fase

8. **Actualizar estado** a "âœ… COMPLETADA"
9. **Actualizar `START_HERE.md`** para la siguiente fase
10. **Crear `phase-X+1-full-context.md`** si no existe
11. **Notificar al humano** y esperar confirmaciÃ³n para continuar

---

## Estados de Fase

| SÃ­mbolo | Estado | Significado |
|---------|--------|-------------|
| â¬œ | PENDIENTE | No iniciada |
| ğŸ”„ | EN PROGRESO | Fase activa |
| âœ… | COMPLETADA | Fase terminada |
| â¸ï¸ | BLOQUEADA | Esperando dependencia |

---

## Estructura de Archivos

```
core/domain/levels/
â”œâ”€â”€ IMPLEMENTATION_PLAN.md      # Plan maestro
â”œâ”€â”€ START_HERE.md               # Punto de entrada (se actualiza por fase)
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ CONTEXT.md              # Contexto global
â”‚   â””â”€â”€ phases/
â”‚       â”œâ”€â”€ phase-X-clarifications.md
â”‚       â””â”€â”€ phase-X-full-context.md
â”œâ”€â”€ filtering/                  # CÃ³digo de Fase 0
â”œâ”€â”€ suppression/                # CÃ³digo de Fase 1
â”œâ”€â”€ conditions/                 # CÃ³digo de Fase 2
â”œâ”€â”€ entities/                   # CÃ³digo de Fase 3
â”œâ”€â”€ providers/                  # CÃ³digo de Fase 4
â”œâ”€â”€ classes/                    # CÃ³digo de Fase 5
â”œâ”€â”€ state/                      # CÃ³digo de Fase 6
â”œâ”€â”€ evaluation/                 # CÃ³digo de Fase 7
â””â”€â”€ __tests__/                  # Tests organizados por carpeta
```

---

## Convenciones de CÃ³digo

- **Runtime/Package Manager**: Bun
- **Tests**: Bun test
- **Tipos**: TypeScript estricto
- **Sin ternarios**: Preferir if/else
- **Legibilidad**: CÃ³digo elegante sobre optimizaciÃ³n

---

## âŒ Comportamientos Prohibidos

1. **NO escribir cÃ³digo sin confirmaciÃ³n del humano** en preguntas de dominio
2. **NO avanzar de fase** sin confirmaciÃ³n explÃ­cita
3. **NO asumir** decisiones de diseÃ±o
4. **NO hacer cambios grandes** sin dividirlos en pasos pequeÃ±os
5. **NO ignorar tests** â€” Test First es obligatorio
