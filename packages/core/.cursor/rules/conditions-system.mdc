---
description: Sistema de Conditions para evaluar prerequisitos y requerimientos
globs:
alwaysApply: false
---

# Sistema de Conditions

El sistema de `Condition` evalúa prerequisitos y requerimientos contra el estado del personaje.

## Tipos de Condition

### SimpleCondition
Comparación numérica entre fórmulas con variables:

```typescript
{
  type: 'simple',
  firstFormula: '@character.bab',
  operator: '>=',
  secondFormula: '6'
}
```

Operadores: `==`, `!=`, `<`, `>`, `<=`, `>=`

### HasEntityCondition
Verifica si el personaje tiene entidades específicas:

```typescript
// Por ID específico
{ type: 'has_entity', entityId: 'power-attack' }

// Por tipo de entidad
{ type: 'has_entity', entityType: 'feat' }

// Con filtro
{ 
  type: 'has_entity', 
  entityType: 'feat',
  filter: [{ field: 'tags', operator: 'contains', value: 'combat' }]
}

// Con conteo mínimo
{ 
  type: 'has_entity', 
  entityType: 'feat',
  filter: [{ field: 'tags', operator: 'contains', value: 'metamagic' }],
  count: { min: 2 }
}
```

## Evaluación

```typescript
import { evaluateConditions } from 'core/domain/levels/conditions/evaluateConditions';

const result = evaluateConditions(conditions, {
  variables: { 'character.bab': 6 },
  characterEntities: [{ id: 'power-attack', entityType: 'feat' }]
});
```

- Lógica AND: todas las conditions deben pasar
- Array vacío o undefined = siempre pasa

## Archivos clave

- Tipos: [conditions.ts](mdc:core/domain/character/baseData/conditions.ts)
- Evaluación: [evaluateConditions.ts](mdc:core/domain/levels/conditions/evaluateConditions.ts)
- Tests: [evaluateConditions.spec.ts](mdc:core/domain/levels/__tests__/conditions/evaluateConditions.spec.ts)
